package com.p2m.core.module

/**
 * A module has a [Module].
 *
 * The [Module] implementation class is auto generated by P2M-APT, it's class name is defined module name
 * in settings.gradle.
 *
 * @see ModuleApi  - a module api.
 * @see ModuleInit - a module initialization.
 */
abstract class Module<MODULE_API : ModuleApi<*, *, *>, MODULE_INIT : ModuleInit> {
    abstract val api: MODULE_API
    protected abstract val init: MODULE_INIT
    protected var _apiClazz: Class<out Module<*, *>>? = null
    @Suppress("UNCHECKED_CAST")
    internal val apiClazz: Class<out Module<*, *>> by lazy {
        _apiClazz ?: this.javaClass.superclass as Class<out Module<*, *>>
    }
    internal val apiClazzName: String
        get() = apiClazz.simpleName
    internal val internalModuleInit: MODULE_INIT
        get() = init
    internal val moduleUnit: ModuleUnit by lazy(LazyThreadSafetyMode.NONE) {
        val moduleUnit by ModuleUnit.Delegate(this.javaClass, this)
        moduleUnit
    }

    protected fun dependOn(moduleClazz: Class<out Module<*, *>>, implClazzName: String) {
        moduleUnit.dependOn(moduleClazz, implClazzName)
    }
}